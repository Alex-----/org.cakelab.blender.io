<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<title>${project.title}</title>
		<!-- standard meta data -->
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="author" content="Holger Machens">
		<meta name="date" content="${system.datetime}">
		<!-- meta data for search engines -->
		<meta name="description" content="${project.description}">
		<meta name="keywords" lang="en" content="${project.keywords}">
		<!-- meta name="robots" content="noindex,nofollow"-->
</head>
<body>
<h1 style="text-align: center">Java Blend</h1>
<br/>
<p style="text-align: center"><em>Providing Type Safe Random Read/Write File Access to</em></p>
<p style="text-align: center"><em>the Full Blender DNA Data Model in Java</em></p>
<br/>
<p style="text-align: center"><b>-- beta --</b></p>
<br/>
<p style="text-align: center">(no decision on type of open source license yet)</p>
<p style="text-align: center">${system.date}</p>
<p style="text-align: center">Holger Machens</p>

<h2>Introduction</h2>
<p>
The Blender core is developed in C and blender files are basically dumps 
of native memory content (C structs and scalar types) 
from heap to a file on disk. A .blend file is organised in blocks of arbitrary length, and 
the type of data is described in a special block, which 
contains type information (meta data) for all C native and 
structured types which can exist in a <code>.blend</code> file.
</p>
<p>
Based on the meta data of any blender file, it is possible to 
generate code for a different language, which is capable to read/write 
the data in blender files of the same version. Java Blend 
is a combination of a code generator and a runtime Blender data access module 
which provides generation of Java classes at development time and 
random access to Blender data at runtime. Together, it provides a generic 
any-version blender file import/export in Java which features all aspects of the
Blender DNA data model. 
</p>
<p>
This toolkit was designed with the ambitious goal to serve for any kind of interaction 
with blender. Whether just importing data into another graphics engine, conversion to 
a different data format or external processing of data to add features to blender. 
The fully generic mapping of the entire Blender DNA core data model combined with 
both import <b>and</b> export supports e.v.e.r.y.t.h.i.n.g! 
Another convenient feature of the generic approach is its low maintenance effort 
on maintainers side (that's me and eventually you ;). New details in blender's DNA will be instantly 
reflected in the generated data model and implicitly supported during import and export.
Thus, users don't have to worry how long they can rely on this library, they can even 
generate new models by themselves without touching the sources.
</p>

<h2>Concept</h2>
<p>
This section gives a brief overview of the general concept behind Java Blend. 
For further details refer to the <a href="spec.html">system specification</a> (not finished yet).
</p>
<h3>Modules</h3>
<p style="text-align: center"><img src="images/model-generator.png"/></p>
<p>
Java Blend basically consists of two modules:
</p>
<dl>
<dt>Model Generator</dt> 
<dd>The model generator (see image above) is a code generator, 
which generates Java code according to the meta data found in a 
reference Blender file. The generated code comprises a data model 
which reflects the data model (so-called DNA) used in Blender core. This generated 
data model consists of facades with methods to access native data 
in heap memory at runtime.
</dd>
<dt>Runtime Data I/O</dt> 
<dd>Random access to native data of a 
Blender file is provided by the data I/O sub-module (see image below) which is 
working behind the scenes at runtime. It is responsible to transfer data between file and heap memory and
supports facades of the data model in address translation, type 
conversion and data access in general. 
</dd>
</dl>


<p style="text-align: center"><img src="images/facade.png"/></p>
<p>
To summarise: Based on the type information of any reference blender 
file, the model generator generates a data model in 
terms of facades which provide type-safe access to native Blender data. 
The generated data model in combination with the runtime data I/O module 
is used at runtime to access data of any Blender file of the same version.
Native Blender data is kept in its format in heap memory and accessed through 
the facades getter and setter methods. Life cycle of native data is implicitly 
covered by the Java VMs garbage collection. 
</p>
<h3>Method</h3>
<p>
At development time, the model generator is used to generate a 
data model for a particular Blender version, based on any 
<code>.blend</code> file created by Blender. The Java classes
of the data model can be generated into a
source folder of a specific project or compiled and archived in 
a separate Java library (<code>.jar</code>), to be used in 
multiple projects.
</p>

<p>
<b>Example</b>
</p>
<pre>
	java -jar javablend.jar "../myproject/src" "my.package.blender" "any-file.blend"
</pre>
<p>
Once the data model is generated, it can be used in combination with the 
runtime data I/O module to access any <code>.blend</code> file of the
same Blender version. The application opens a Blender file and retrieves
a <code>Main</code> library. In Blender terminology a 'Library' 
represents a file (even external non-blender files). A main library 
provides access to all persistent data in a Blender instance that will be 
stored in a .blend file (all 3D elements, UI and rendering configurations
etc.). The example below shows a use case, where an application opens a 
blender file and retrieves the polygons of a mesh.
</p>
<p>
<b>Example</b>
</p>
<pre>
	//
	// Open file and retrieve main lib
	//
	BlenderFile f = new BlenderFile("cube.blend");
	MainLib main = new MainLib(f);
	f.close();
	
	//
	// retrieve the first mesh's polygons
	//
	Mesh mesh = lib.getMesh();
	MPoly[] polygons = mesh.getMpoly().toArray(mesh.getTotpoly());
</pre>
<p>
<em>A more comprehensive example involving materials and textures can be 
found in the download section below.</em>
</p>

<h2>Download</h2>
<p>
This is the second tech. demo now comprising all features of Java Blend, such as import/export, 
dealing with facades of a generated data model as well as pointers and arrays. 
It consists of
</p>
<ul>
<li>the <b><a href="downloads/JavaBlend-src-0.0.2.zip">source code</a></b> of model generator and data I/O and</li>
<li>a use case <b><a href="downloads/JavaBlendDemo-src-0.0.2.zip">example with generated data model</a></b> for blender v2.69 
demonstrating how to read and display a textured cube modelled in blender, and</li>
<li>a <b><a href="downloads/JavaBlendDemo-0.0.2.zip">binary of 
the example</a></b> to show that (horribly) textured cube in action. It uses <a href="https://www.lwjgl.org/">LWJGL</a> and requires
a graphics card which supports <a href="https://www.opengl.org/">OpenGL 4.3</a>.
</li>
</ul>
<p><em>Please note: The <a href="spec.html">documentation</a> is not finished (see roadmap).</em>
</p>

<h2>Roadmap</h2>
<ul>
<li>File compression/decompression (?)</li>
<li>Finishing documentation and adding community based documentation system support</li>
<li>More examples</li>
<li>Testing, improving, optimising, polishing</li>
<li>Release (end of 2015)</li>
</ul>

<h2>Change Log</h2>
<ul>
<li>[0.0.2]: Second tech. demo comprising all specified features
	<ul>
	<li>Refactored the hell out of it!</li>
	<li>Fixed several bugs</li>
	<li>Improved source code documentation all over the place</li>
	<li>Added support for blender <b>version compatibility checks</b> against data model version</li>
	<li>Introduced blender file <b>write access</b></li>
	<li>Introduced blender <b>file creation</b> and initialisation (with StructDNA and FileGlobal)</li>
	<li>Added creation of StructDNA to support initialisation of .blend files.</li>
	<li>Added blender <b>factory class</b> supporting allocation of blocks and implicit assignment to facades</li>
	<li>Made generation of blender version specific utilities optional, since those are not fully generic.</li>
	<li>Introduced <b>allocator to manage virtual addresses</b> of a block table for block allocation</li>
	<li>Introduced <b>documentation system</b> to provide more information to generated classes</li>
	<li>Added script to extract documentation from blender python api</li>
	<li>Documentation system considers file version to retrieve appropriate version of available documentation</li>
	<li>Added several methods to convert between strings, arrays, pointers considering null termination and charsets.</li>
	<li>Added conversion of pointers or array facades to Java native scalar type arrays</li>
	<li>Introduced iterators for arrays</li>
	<li>Optimised bulk data retrieval</li>
	<li>Improved runtime adaption to architecture dependent encoding (byte order and address width)</li>
	</ul>
</li> <!-- 0.0.2 -->
<li>[0.0.1]: First demo of model generation and data reading capabilities
	<ul>
	<li>add: Facade concept for structured C types</li>
	<li>add: Abstraction for C pointers and arrays</li>
	<li>add: data model generation from StructDNA</li>
	<li>add: runtime conversion between Java and native data representations</li>
	<li>mod: demo application (cube.blend)</li>
	</ul>
</li> <!-- 0.0.2 -->
</ul>

</body>
</html>